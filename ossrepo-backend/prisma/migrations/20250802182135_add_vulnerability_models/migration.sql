-- CreateTable
CREATE TABLE "vulnerabilities" (
    "id" TEXT NOT NULL,
    "watchlist_id" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "severity" TEXT NOT NULL,
    "cve_id" TEXT,
    "ghsa_id" TEXT,
    "published_date" TIMESTAMP(3) NOT NULL,
    "affected_versions" TEXT[],
    "fixed_versions" TEXT[],
    "references" JSONB NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "vulnerabilities_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "vulnerability_summaries" (
    "id" TEXT NOT NULL,
    "watchlist_id" TEXT NOT NULL,
    "total_count" INTEGER NOT NULL DEFAULT 0,
    "critical_count" INTEGER NOT NULL DEFAULT 0,
    "high_count" INTEGER NOT NULL DEFAULT 0,
    "medium_count" INTEGER NOT NULL DEFAULT 0,
    "low_count" INTEGER NOT NULL DEFAULT 0,
    "last_updated" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "vulnerability_summaries_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE INDEX "vulnerabilities_watchlist_id_idx" ON "vulnerabilities"("watchlist_id");

-- CreateIndex
CREATE INDEX "vulnerabilities_severity_idx" ON "vulnerabilities"("severity");

-- CreateIndex
CREATE INDEX "vulnerabilities_published_date_idx" ON "vulnerabilities"("published_date");

-- CreateIndex
CREATE UNIQUE INDEX "vulnerability_summaries_watchlist_id_key" ON "vulnerability_summaries"("watchlist_id");

-- CreateIndex
CREATE INDEX "vulnerability_summaries_watchlist_id_idx" ON "vulnerability_summaries"("watchlist_id");

-- AddForeignKey
ALTER TABLE "vulnerabilities" ADD CONSTRAINT "vulnerabilities_watchlist_id_fkey" FOREIGN KEY ("watchlist_id") REFERENCES "Watchlist"("watchlist_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "vulnerability_summaries" ADD CONSTRAINT "vulnerability_summaries_watchlist_id_fkey" FOREIGN KEY ("watchlist_id") REFERENCES "Watchlist"("watchlist_id") ON DELETE CASCADE ON UPDATE CASCADE;
